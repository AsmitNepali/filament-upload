var o=r=>r.type==="application/pdf",u=r=>new URLSearchParams({toolbar:r.query("GET_PDF_TOOLBAR")?1:0,navpanes:r.query("GET_PDF_NAVPANE")?1:0,statusbar:r.query("GET_PDF_STATUS_BAR")?1:0,zoom:r.query("GET_PDF_ZOOM")?1:0,view:r.query("GET_PDF_VIEW"),scrollbar:r.query("GET_PDF_SCROLLBAR")?1:0,page:r.query("GET_PDF_DISPLAY_PAGE")}),y=r=>{let a=({root:i,props:d})=>{let{id:s}=d,n=i.query("GET_ITEM",s),c=window.URL||window.webkitURL,p=new Blob([n.file],{type:n.file.type}),e=u(i);i.ref.pdf.src=`${c.createObjectURL(p)}#${e.toString()}`,i.ref.pdf.addEventListener("load",()=>{i.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s,height:i.ref.pdf.scrollHeight})},!1)},t=({root:i,props:d})=>{i.query("GET_ITEM",d.id).file&&(i.ref.pdf=document.createElement("iframe"),i.ref.pdf.setAttribute("height",i.query("GET_PDF_PREVIEW_HEIGHT")||320),i.ref.pdf.classList.add("filepond--pdf-preview-iframe"),i.element.appendChild(i.ref.pdf))};return r.createView({name:"pdf-preview",tag:"div",create:t,write:r.createRoute({DID_PDF_PREVIEW_LOAD:a})})},I=r=>r.createView({name:"overlay-shadow",tag:"div",ignoreRect:!0,create:({root:a,props:t})=>{a.element.classList.add(`overlay-shadow--${t.status}`)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),T=r=>{let a=r.utils,t=y(a),i=I(a),d=({root:e,props:l})=>{let{id:f}=l;e.dispatch("DID_PDF_PREVIEW_LOAD",{id:f})},s=({root:e,props:l})=>{e.ref.overlayShadow=e.appendChildView(e.createChildView(i,{opacity:1,status:"idle"})),e.ref.overlaySuccess=e.appendChildView(e.createChildView(i,{opacity:0,status:"success"})),e.ref.overlayError=e.appendChildView(e.createChildView(i,{opacity:0,status:"failure"})),e.ref.pdf=e.appendChildView(e.createChildView(t,{id:l.id}))},n=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},c=({root:e,props:l})=>{e.ref.overlayShadow.opacity=.1,e.ref.overlayError.opacity=1},p=({root:e,props:l})=>{e.ref.overlayShadow.opacity=.1,e.ref.overlaySuccess.opacity=1};return a.createView({name:"pdf-preview-wrapper",tag:"div",create:s,write:a.createRoute({DID_CREATE_PDF_PREVIEW_CONTAINER_VIEW:d,DID_THROW_ITEM_LOAD_ERROR:c,DID_THROW_ITEM_PROCESSING_ERROR:c,DID_THROW_ITEM_INVALID:c,DID_COMPLETE_ITEM_PROCESSING:p,DID_START_ITEM_PROCESSING:n,DID_REVERT_ITEM_PROCESSING:n})})},D=r=>{let{addFilter:a,utils:t}=r,{Type:i,createRoute:d}=t,s=T(r);return a("CREATE_VIEW",n=>{let{is:c,view:p,query:e}=n;if(!c("file"))return;let l=({root:f,props:w})=>{let{id:E}=w,_=e("GET_ITEM",E);!_||!o(_?.file)||_?.archived||(f.ref.pdfPreview=p.appendChildView(p.createChildView(s,{id:E})),f.dispatch("DID_CREATE_PDF_PREVIEW_CONTAINER_VIEW",{id:E}))};p.registerWriter(d({DID_LOAD_ITEM:l}),(f,w)=>{console.log("init"),f.ref.pdfPreview&&f.rect.element.hidden})}),{options:{allowPdfPreview:[!0,i.BOOLEAN],pdfPreviewHeight:[400,i.INT],pdfToolbar:[!1,i.BOOLEAN],pdfNavPanes:[!1,i.BOOLEAN],pdfStatusBar:[!1,i.BOOLEAN],pdfZoom:[!1,i.BOOLEAN],pdfView:["fitW",i.STRING],pdfDisplayPage:[1,i.INT]}}},P=D;function R(r){document.addEventListener("FilePond:loaded",function(){let a=window.FilePond;a.registerPlugin(P),a.setOptions(r)})}export{R as default};
