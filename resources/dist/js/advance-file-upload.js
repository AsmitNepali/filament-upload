var P=r=>r.type==="application/pdf",u=r=>{let t=({root:i,props:d})=>{let{id:s}=d,n=i.query("GET_ITEM",s),c=window.URL||window.webkitURL,p=new Blob([n.file],{type:n.file.type}),e=new URLSearchParams({toolbar:0,navpanes:0,scrollbar:0,statusbar:0,zoom:0,messages:0,view:"fitH",page:1});i.ref.pdf.src=`${c.createObjectURL(p)}#${e.toString()}`,i.ref.pdf.addEventListener("load",()=>{i.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s,height:i.ref.pdf.scrollHeight})},!1)},a=({root:i,props:d})=>{i.query("GET_ITEM",d.id).file&&(i.ref.pdf=document.createElement("iframe"),i.ref.pdf.setAttribute("height",i.query("GET_PDF_PREVIEW_HEIGHT")||320),i.ref.pdf.classList.add("filepond--pdf-preview-iframe"),i.element.appendChild(i.ref.pdf))};return r.createView({name:"pdf-preview",tag:"div",create:a,write:r.createRoute({DID_PDF_PREVIEW_LOAD:t})})},I=r=>r.createView({name:"overlay-shadow",tag:"div",ignoreRect:!0,create:({root:t,props:a})=>{t.element.classList.add(`overlay-shadow--${a.status}`)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),v=r=>{let t=r.utils,a=u(t),i=I(t),d=({root:e,props:l})=>{let{id:f}=l;e.dispatch("DID_PDF_PREVIEW_LOAD",{id:f})},s=({root:e,props:l})=>{e.ref.overlayShadow=e.appendChildView(e.createChildView(i,{opacity:1,status:"idle"})),e.ref.overlaySuccess=e.appendChildView(e.createChildView(i,{opacity:0,status:"success"})),e.ref.overlayError=e.appendChildView(e.createChildView(i,{opacity:0,status:"failure"})),e.ref.pdf=e.appendChildView(e.createChildView(a,{id:l.id}))},n=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},c=({root:e,props:l})=>{e.ref.overlayShadow.opacity=.1,e.ref.overlayError.opacity=1},p=({root:e,props:l})=>{e.ref.overlayShadow.opacity=.1,e.ref.overlaySuccess.opacity=1};return t.createView({name:"pdf-preview-wrapper",tag:"div",create:s,write:t.createRoute({DID_CREATE_PDF_PREVIEW_CONTAINER_VIEW:d,DID_THROW_ITEM_LOAD_ERROR:c,DID_THROW_ITEM_PROCESSING_ERROR:c,DID_THROW_ITEM_INVALID:c,DID_COMPLETE_ITEM_PROCESSING:p,DID_START_ITEM_PROCESSING:n,DID_REVERT_ITEM_PROCESSING:n})})},y=r=>{let{addFilter:t,utils:a}=r,{Type:i,createRoute:d}=a,s=v(r);return t("CREATE_VIEW",n=>{let{is:c,view:p,query:e}=n;if(!c("file"))return;let l=({root:f,props:w})=>{let{id:o}=w,E=e("GET_ITEM",o);!E||!P(E?.file)||E?.archived||(f.ref.pdfPreview=p.appendChildView(p.createChildView(s,{id:o})),f.dispatch("DID_CREATE_PDF_PREVIEW_CONTAINER_VIEW",{id:o}))};p.registerWriter(d({DID_LOAD_ITEM:l}),(f,w)=>{console.log("init"),f.ref.pdfPreview&&f.rect.element.hidden})}),{options:{allowPdfPreview:[!0,i.BOOLEAN],pdfPreviewHeight:[400,i.INT],pdfScrollbar:[!0,i.BOOLEAN],pdfDisplayPage:[1,i.INT]}}},_=y;function D(r){document.addEventListener("FilePond:loaded",function(){let t=window.FilePond;t.registerPlugin(_),t.setOptions(r)})}export{D as default};
